import json
import os

def generate_html():
    # File paths
    json_path = 'Ideas.json'
    output_path = 'index.html'
    
    # Fail-safe: Check if JSON exists
    if not os.path.exists(json_path):
        print(f"Error: {json_path} not found. Creating a placeholder.")
        data = {"ideas": []}
    else:
        try:
            with open(json_path, 'r', encoding='utf-8') as f:
                data = json.load(f)
        except Exception as e:
            print(f"Error parsing JSON: {e}")
            data = {"ideas": []}

    # Images listed in your request
    images = [
        "IMG-20260224-WA0041.jpg",
        "IMG-20260224-WA0042.jpg",
        "IMG-20260224-WA0043.jpg"
    ]

    # HTML Template with Tailwind CSS
    html_content = f"""
    <!DOCTYPE html>
    <html lang="he" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>צוות פיתוח - מאגר רעיונות</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&display=swap" rel="stylesheet">
        <style>
            body {{ font-family: 'Assistant', sans-serif; }}
        </style>
    </head>
    <body class="bg-gray-50 text-gray-900">
        <nav class="bg-blue-600 p-4 text-white shadow-lg">
            <div class="container mx-auto">
                <h1 class="text-2xl font-bold text-center">מרכז הרעיונות והדרישות של הצוות</h1>
            </div>
        </nav>

        <main class="container mx-auto py-8 px-4">
            <section class="mb-12">
                <h2 class="text-xl font-bold mb-6 border-b-2 border-blue-500 pb-2">רעיונות רשומים (מתוך JSON)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    """

    # Add ideas from JSON
    if not data.get("ideas"):
        html_content += '<p class="text-gray-500 italic">אין רעיונות להצגה כרגע.</p>'
    else:
        for idea in data["ideas"]:
            html_content += f"""
                    <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow border-t-4 border-blue-400">
                        <h3 class="font-bold text-lg mb-2">{idea.get('title', 'ללא כותרת')}</h3>
                        <p class="text-gray-600 mb-4">{idea.get('description', 'אין תיאור זמין')}</p>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500">{idea.get('category', 'כללי')}</span>
                    </div>
            """

    html_content += """
                </div>
            </section>

            <section>
                <h2 class="text-xl font-bold mb-6 border-b-2 border-green-500 pb-2">דרישות ופרוטוקולים (תמונות מהמאגר)</h2>
                <div class="space-y-8">
    """

    # Add images
    for img in images:
        if os.path.exists(img):
            html_content += f"""
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <p class="mb-2 text-sm font-semibold text-gray-700">{img}</p>
                        <img src="{img}" alt="Requirement Image" class="w-full rounded shadow-sm border">
                    </div>
            """
        else:
            html_content += f'<p class="text-red-400 italic">תמונה חסרה במאגר: {img}</p>'

    html_content += """
                </div>
            </section>
        </main>

        <footer class="mt-12 py-6 bg-gray-200 text-center text-gray-600 text-sm">
            <p>עודכן אוטומטית על ידי GitHub Senior AI Partner</p>
        </footer>
    </body>
    </html>
    """

    # Write output
    try:
        with open(output_path, 'w', encoding='utf-8') as f:
            f.write(html_content)
        print(f"Successfully generated {output_path}")
    except Exception as e:
        print(f"Error writing HTML: {e}")

if __name__ == "__main__":
    generate_html()
